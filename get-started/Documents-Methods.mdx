In this section, we will see how to use the methods of the `documents` client.

## Create Messages

<ParamField path="create_messages" type="Function">
  Creates messages from a document for use with LLM models
  <Expandable title="parameters">
    <ParamField path="document" type="Path | str | IO[bytes] | PIL.Image.Image">
      The document to process. Can be a file path, string content, bytes IO object, or PIL Image object.
    </ParamField>

    <ParamField path="modality" type="string" default="native">
      The modality to use for processing the document. Can be:
      - "native" (default) - Uses the document's native modality based on file type
      - "image+text" - Uses both the document's native modality and processes as text
      - "text" - Process as text
      - "image" - Process as image 
      - "audio" - Process as audio
      - "video" - Process as video
    </ParamField>

    <ParamField path="text_operations" type="TextOperations">
      Optional text operations to perform on the document:
      <Expandable title="properties">
        <ParamField path="regex_instructions" type="array[RegexInstruction]">
          List of regex patterns to identify data in the text
          <Expandable title="RegexInstruction properties">
            <ParamField path="name" type="string">Key/label for data (e.g., "VATNumber")</ParamField>
            <ParamField path="pattern" type="string">Regex pattern to match</ParamField>
            <ParamField path="description" type="string">Description of what to extract</ParamField>
          </Expandable>
        </ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="image_operations" type="ImageOperations">
      Optional image preprocessing operations:
      <Expandable title="properties">
        <ParamField path="correct_image_orientation" type="boolean">Whether to correct the image orientation</ParamField>
        <ParamField path="dpi" type="integer">The DPI of the image</ParamField>
        <ParamField path="image_to_text" type="'ocr' | 'llm_description'">Whether to convert the image to text</ParamField>
        <ParamField path="browser_canvas" type="'A3' | 'A4' | 'A5'">The canvas of the browser (default = A4)</ParamField>
      </Expandable>
    </ParamField>

    
  </Expandable>
</ParamField>
<ResponseField name="Response" type="DocumentMessage Object">
A DocumentMessage object with the messages created from the document.
  <Expandable title="properties">
    <ResponseField name="id" type="string">
      A unique identifier for the document loading.
    </ResponseField>

    <ResponseField name="object" type="string">
      The type of object being loaded. Always "document.message".
    </ResponseField>

    <ResponseField name="messages" type="array[ChatCompletionUiformMessage]">
      A list of messages containing the document content and metadata.
    </ResponseField>

    <ResponseField name="created" type="integer">
      The Unix timestamp (in seconds) of when the document was loaded.
    </ResponseField>

    <ResponseField name="modality" type="string">
      The modality of the document to load.
    </ResponseField>

    <ResponseField name="document" type="BaseMIMEData Object">
      The document being loaded.
    </ResponseField>

    <ResponseField name="items" type="array">
      Returns the items in the document as a list of strings or PIL Images.
    </ResponseField>

    <ResponseField name="openai_messages" type="array[ChatCompletionMessageParam]">
      Returns the messages in OpenAI's format.
    </ResponseField>

    <ResponseField name="anthropic_system_prompt" type="string">
      Returns the system message in Anthropic's Claude format.
    </ResponseField>

    <ResponseField name="anthropic_messages" type="array[MessageParam]">
      Returns the messages in Anthropic's Claude format.
    </ResponseField>

    <ResponseField name="gemini_messages" type="ContentsType">
      Returns the messages in Google's Gemini format.
    </ResponseField>
  </Expandable>
</ResponseField>

<CodeGroup>
```python Request
from uiform import UiForm
from openai import OpenAI

uiclient = UiForm()
doc_msg = uiclient.documents.create_messages(
    document = "freight/booking_confirmation.jpg",
    modality = "text",
    text_operations = {
        "regex_instructions": [{
            "name": "VAT Number",
            "description": "All potential VAT numbers in the documents",
            "pattern": r"[Ff][Rr]\s*(\d\s*){11}"
        }],
    },
    image_operations = {
        "correct_image_orientation": True,
        "dpi": 72,
        "image_to_text": "ocr",
        "browser_canvas": "A4"
    }
)
```
```json Response
{
    "id": "doc_dd003f95-81ce-4a55-9180-00c5a58d82ec",
    "object": "document.message",
    "messages": [
        {
            "role": "user",
            "content": [
                {
                    "text": "/, ACME\n\n4% Corporation\u201d\n\nConfirmation d'affr\u00e9tement\nACME CORPORATION\n\nVAT Number: GB123456789\n\n11/8/2024, 11:41:43 AM\n\naA\n\nD\u00e9tails de la soci\u00e9t\u00e9 Site de: Adresse de facturation:\nContact: Jane Doe 456 Oak Avenue 123 Elm Street\nAcme Corporation Floor 3 Suite 500\nTel: +44 20 7946 0958 Manchester London\nEmail: client@acme.com M1 4WP. WC2N S5DU GB\nUnited Kingdom Tel: +44 20 7946 0958\n\nEmail: client@acme.com\nVAT Number: GB123456789\n\nR\u00e9f\u00e9rence a rappeler sur votre\nfacture\n\nN\u00b0OT : SHIP-001\n\nR\u00e9f.Client : BC-67890\n\nN\u00b0 Cde : SHIP-001\n\nTransporteur :\n\nTRANSPORT EXPRESS.\nAl'attention du Service Logistique\nZone Industrielle Est, Batiment C\n45 rue des Transporteurs\n\n75001 PARIS\n\nFRANCE\n\nT\u00e9l : 0123 45 67 89\n\nFax : 0123 45 67 90\n\nTva : FR12 345 678 901\n\nLe transporteur s'engage :\n\ne a-souscrire une assurance sp\u00e9cifique aux marchandises\nsensibles.\n\n* arespecter les clauses vol de ses polices d'assurance\nmarchandises transport\u00e9es.\n\n\u00a2 a v\u00e9rifier que les marchandises soient bien accompagn\u00e9es des\ndocuments et notamment des documents de douane\ncorrespondants.\n\n\u00a2 ad\u00e9clarer les incidents et notamment contacter imm\u00e9diatement\nnotre bureau d'affr\u00e9tement et le bureau de douanes le plus\nproche en cas de vol attest\u00e9.\n\n\u00a2 a mettre en oeuvre les moyens de pr\u00e9vention visant a la\ns\u00e9curisation de la marchandise dont le stationnement dans des\nendroits clos et gardienn\u00e9s.\n\n \n\nNature des marchandises: Prise en charge le Livraison le\nPoids: 500 T Pallets: 5 Unit\u00e9s: 10 Volume: 1.44 M3 5/2/2023 5/3/2023\nMetres de chargement: 0.4 ML De 08:00 a 12:00 De 10:00 a 16:00\nTemp\u00e9rature: 5\u00b0C - 25\u00b0C (Frais) Acme Corporation Beta Industries\nMarchandises dangereuses: UN1202 Classe 3 - Liquide 123 Elm Street 789 Pine Street\ninflammable Suite 500 Munich, Bavaria\nLondon, Greater London 80331 DE\nWC2N SDU GB +49 89 123456\n\n \n\n \n\n \n\nPrix convenu: 1500 EUR HT PRIX NEGOCIE GASOIL INCLUS R\u00e9f\u00e9rence a rappeler sur votre facture :\n\nBC-67890\n\nConditions de transport et de reglement :\n\nAfin de permettre un reglement conforme aux dispositions, il est rappel\u00e9 au transporteur affr\u00e9t\u00e9 que la facture ne sera admise pour paiement que sous\nla condition stricte de reception des documents l\u00e9gaux requis pour justifier de la r\u00e9alisation de la prestation de transport et notamment : I'original de la\nlettre de voiture accompagn\u00e9 du bon de livraison original r\u00e9gularis\u00e9 et la preuve de l'\u00e9change des palettes consign\u00e9es. II est a noter que le prix\nconvenu a fait l'objet d'une n\u00e9gociation entre les parties et qu'il integre notamment les charges de carburant sur la base de l'indice CNR du mois en\ncours a la date de r\u00e9alisation du transport. Pour les flux belges, le prix convenu comprend la taxe kilom\u00e9trique. Le transporteur affr\u00e9teur s'oblige a\nex\u00e9cuter l'ordre de transport confi\u00e9 par ses propres moyens. Il s'interdit de le sous-traiter a des tiers. Le non respect de cette clause entraine la\nr\u00e9solution imm\u00e9diate et de plein droit du contrat de transport. Il reconnait \u00e9galement que le forfait ci-dessus permet de couvrir l'ensemble des charges\nd\u00e9finies a l'article L3221-1 du Code des Transports. En cons\u00e9quence, il d\u00e9clare \u00e9tre a jour de son obligation de d\u00e9claration, du paiement des charges\nsociales (URSSAF) et du respect de la lutte contre le travail ill\u00e9gal. Il s'engage a respecter les obligations sur le d\u00e9tachement transnational de salari\u00e9s,\naussi il doit \u00e9tre a jour de |'\u00e9tablissement de I'attestation de d\u00e9tachement des salari\u00e9s ainsi que de la nomination d'un repr\u00e9sentant en France. Nous\nvous rappelons la l\u00e9gislation frangaise concernant le cabotage routier de marchandises qui fait l'objet des articles L.3421-3 et suivants du Code des\nTransports modifi\u00e9s par le d\u00e9cret n\u00b0 2016-418 du 7 avril 2016, tout transport doit donc \u00e9tre effectu\u00e9 dans le respect de la loi. Nous vous remercions de\nnous tenir imm\u00e9diatement inform\u00e9s de tout incident rencontr\u00e9 dans |'ex\u00e9cution de ce transport.\n\n \n\nSile transport de marchandises s'effectue sur Retour imp\u00e9ratif par fax avec la mention Bon\ndes palettes Europe, celles-ci doivent \u00e9tre pour accord, votre cachet commercial, vos\n\u00e9chang\u00e9es au chargement ou restitu\u00e9es sous noms et signature. A d\u00e9faut de retour, le\n\n8 jours. Dans le cas contraire, elles vous seront contrat de transport sera r\u00e9put\u00e9 ex\u00e9cut\u00e9 selon\nfactur\u00e9es au prix de 28 \u20ac ht/Palette (14 \u20achtde \u2014_les modalit\u00e9s pr\u00e9cit\u00e9es.Tous les bons de\n\nfrais de dossier non remboursable en cas livraisons devront \u00e9tre retourn\u00e9s sous 8 jours.\nd'avoir).\n\n \n\n \n\n \n\f",
                    "type": "text"
                }
            ]
        }
    ],
    "created": 1736524416,
    "modality": "text",
    "document": {
        "id": "cf908729402d0796537bb91e63df5e339ce93b4cabdcac2f9a4f90592647e130",
        "name": "booking_confirmation.jpg",
        "mime_type": "image/jpeg"
    }
}
```
</CodeGroup>

<Note>Use `doc_msg.items` to have a list of `[PIL.Image.Image | str]` objects</Note>


## Correct image orientation

<ParamField path="correct_image_orientation" type="function">
  Corrects the orientation of an image using the UiForm API.
  <Expandable title="parameters">
    <ParamField path="document" type="Path | str | IOBase | MIMEData | PIL.Image.Image" required>
      The input image to correct. Can be:
      - A file path (Path or str)
      - A file-like object (IOBase) 
      - A MIMEData object
      - A PIL Image object
    </ParamField>
  </Expandable>
</ParamField>

<ResponseField name="Response" type="PIL.Image.Image">
  The orientation-corrected image as a PIL Image object
</ResponseField>

<CodeGroup>
```python Request
from uiform import UiForm
from openai import OpenAI

uiclient = UiForm()
doc_msg = uiclient.documents.correct_image_orientation(
    document = "freight/booking_confirmation.jpg",
)
```
```json Response
{
    "document": {
        "id": "cf908729402d0796537bb91e63df5e339ce93b4cabdcac2f9a4f90592647e130",
        "name": "booking_confirmation.jpg",
        "mime_type": "image/jpeg",
        "content": "..."
    }
}
```
</CodeGroup>



## Extractions

### extractions.parse

<ParamField path="extractions.parse" type="function">
  Extract structured data from a document using a JSON schema
  <Expandable title="parameters">
    <ParamField path="json_schema" type="dict[str, Any] | Path | str" required>
      The JSON schema defining the structure to extract. Can be a dict, file path, or string.
    </ParamField>
    
    <ParamField path="document" type="Path | str | IO[bytes]" required>
      The document to extract from. Can be a file path, string, or bytes IO object.
    </ParamField>

    <ParamField path="text_operations" type="TextOperations">
      Optional text operations to perform on the document:
      <Expandable title="properties">
        <ParamField path="regex_instructions" type="array[RegexInstruction]">
          List of regex patterns to identify data in the text
          <Expandable title="RegexInstruction properties">
            <ParamField path="name" type="string">Key/label for data (e.g., "VATNumber")</ParamField>
            <ParamField path="pattern" type="string">Regex pattern to match</ParamField>
            <ParamField path="description" type="string">Description of what to extract</ParamField>
          </Expandable>
        </ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="image_operations" type="ImageOperations">
      Optional image preprocessing operations:
      <Expandable title="properties">
        <ParamField path="correct_image_orientation" type="boolean">Whether to correct the image orientation</ParamField>
        <ParamField path="dpi" type="integer">The DPI of the image</ParamField>
        <ParamField path="image_to_text" type="'ocr' | 'llm_description'">Whether to convert the image to text</ParamField>
        <ParamField path="browser_canvas" type="'A3' | 'A4' | 'A5'">The canvas of the browser (default = A4)</ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="model" type="string" default="gpt-4o-2024-08-06">
      The model to use for extraction.
    </ParamField>

    <ParamField path="temperature" type="float" default="0">
      The sampling temperature to use.
    </ParamField>

    <ParamField path="messages" type="array[ChatCompletionUiformMessage]" default="[]">
      Optional list of previous messages to include. Each message must have:
      <Expandable title="properties">
        <ParamField path="role" type="string">
          The role of the message sender. Must be one of:
          - "user"
          - "system" 
          - "assistant"
        </ParamField>
        <ParamField path="content" type="string | array[ChatCompletionContentPartParam]">
          The content of the message. Can be a string or array of content parts:
          <Expandable title="ChatCompletionContentPartParam">
            <ParamField path="text" type="object">
              A text content part
              <Expandable title="properties">
                <ParamField path="text" type="string">
                  The text content
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "text"
                </ParamField>
              </Expandable>
            </ParamField>

            <ParamField path="image_url" type="object">
              An image content part
              <Expandable title="properties">
                <ParamField path="image_url" type="object">
                  <Expandable title="properties">
                    <ParamField path="url" type="string">
                      URL or base64 encoded image data
                    </ParamField>
                    <ParamField path="detail" type="string">
                      Detail level: "auto", "low", or "high"
                    </ParamField>
                  </Expandable>
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "image_url"
                </ParamField>
              </Expandable>
            </ParamField>

            <ParamField path="input_audio" type="object">
              An audio content part
              <Expandable title="properties">
                <ParamField path="input_audio" type="object">
                  <Expandable title="properties">
                    <ParamField path="data" type="string">
                      Base64 encoded audio data
                    </ParamField>
                    <ParamField path="format" type="string">
                      Must be "wav" or "mp3"
                    </ParamField>
                  </Expandable>
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "input_audio"
                </ParamField>
              </Expandable>
            </ParamField>
          </Expandable>
        </ParamField>
      </Expandable>
    </ParamField>

   
    <ParamField path="modality" type="string" default="native">
      The modality to use for processing the document. Can be:
      - "native" (default) - Uses the document's native modality based on file type
      - "image+text" - Uses both the document's native modality and processes as text
      - "text" - Process as text
      - "image" - Process as image 
      - "audio" - Process as audio
      - "video" - Process as video
    </ParamField>

  </Expandable>
</ParamField>

<ResponseField name="Response" type="ParsedChatCompletion">
An OpenAI ParsedChatCompletion object with the extracted data.
</ResponseField>

### extractions.stream

<ParamField path="extractions.stream" type="function">
  Extract structured data from a document using a JSON schema
  <Expandable title="parameters">
    <ParamField path="json_schema" type="dict[str, Any] | Path | str" required>
      The JSON schema defining the structure to extract. Can be a dict, file path, or string.
    </ParamField>
    
    <ParamField path="document" type="Path | str | IO[bytes]" required>
      The document to extract from. Can be a file path, string, or bytes IO object.
    </ParamField>

    <ParamField path="text_operations" type="TextOperations">
      Optional text operations to perform on the document:
      <Expandable title="properties">
        <ParamField path="regex_instructions" type="array[RegexInstruction]">
          List of regex patterns to identify data in the text
          <Expandable title="RegexInstruction properties">
            <ParamField path="name" type="string">Key/label for data (e.g., "VATNumber")</ParamField>
            <ParamField path="pattern" type="string">Regex pattern to match</ParamField>
            <ParamField path="description" type="string">Description of what to extract</ParamField>
          </Expandable>
        </ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="image_operations" type="ImageOperations">
      Optional image preprocessing operations:
      <Expandable title="properties">
        <ParamField path="correct_image_orientation" type="boolean">Whether to correct the image orientation</ParamField>
        <ParamField path="dpi" type="integer">The DPI of the image</ParamField>
        <ParamField path="image_to_text" type="'ocr' | 'llm_description'">Whether to convert the image to text</ParamField>
        <ParamField path="browser_canvas" type="'A3' | 'A4' | 'A5'">The canvas of the browser (default = A4)</ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="model" type="string" default="gpt-4o-2024-08-06">
      The model to use for extraction.
    </ParamField>

    <ParamField path="temperature" type="float" default="0">
      The sampling temperature to use.
    </ParamField>

    <ParamField path="messages" type="array[ChatCompletionUiformMessage]" default="[]">
      Optional list of previous messages to include. Each message must have:
      <Expandable title="properties">
        <ParamField path="role" type="string">
          The role of the message sender. Must be one of:
          - "user"
          - "system" 
          - "assistant"
        </ParamField>
        <ParamField path="content" type="string | array[ChatCompletionContentPartParam]">
          The content of the message. Can be a string or array of content parts:
          <Expandable title="ChatCompletionContentPartParam">
            <ParamField path="text" type="object">
              A text content part
              <Expandable title="properties">
                <ParamField path="text" type="string">
                  The text content
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "text"
                </ParamField>
              </Expandable>
            </ParamField>

            <ParamField path="image_url" type="object">
              An image content part
              <Expandable title="properties">
                <ParamField path="image_url" type="object">
                  <Expandable title="properties">
                    <ParamField path="url" type="string">
                      URL or base64 encoded image data
                    </ParamField>
                    <ParamField path="detail" type="string">
                      Detail level: "auto", "low", or "high"
                    </ParamField>
                  </Expandable>
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "image_url"
                </ParamField>
              </Expandable>
            </ParamField>

            <ParamField path="input_audio" type="object">
              An audio content part
              <Expandable title="properties">
                <ParamField path="input_audio" type="object">
                  <Expandable title="properties">
                    <ParamField path="data" type="string">
                      Base64 encoded audio data
                    </ParamField>
                    <ParamField path="format" type="string">
                      Must be "wav" or "mp3"
                    </ParamField>
                  </Expandable>
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "input_audio"
                </ParamField>
              </Expandable>
            </ParamField>
          </Expandable>
        </ParamField>
      </Expandable>
    </ParamField>

   
    <ParamField path="modality" type="string" default="native">
      The modality to use for processing the document. Can be:
      - "native" (default) - Uses the document's native modality based on file type
      - "image+text" - Uses both the document's native modality and processes as text
      - "text" - Process as text
      - "image" - Process as image 
      - "audio" - Process as audio
      - "video" - Process as video
    </ParamField>

  </Expandable>
</ParamField>

<ResponseField name="Response" type="AsyncChatCompletionStreamManager[ResponseFormatT]">
An OpenAI AsyncChatCompletionStreamManager[ResponseFormatT] object with the extracted data.
</ResponseField>


<CodeGroup>
```python Request (parse)

from uiform import UiForm

uiclient = UiForm()

doc_msg = uiclient.documents.extractions.parse(
    document = "freight/booking_confirmation.jpg", 
    model="gpt-4o-mini",
    json_schema = {
      'X-SystemPrompt': 'You are a useful assistant.',
      'properties': {
          'name': {
              'X-FieldPrompt': 'Provide a descriptive and concise name for the event.',
              'description': 'The name of the calendar event.',
              'title': 'Name',
              'type': 'string'
          },
          'date': {
              'X-FieldPrompt': 'Specify the event date in YYYY-MM-DD format.',
              'description': 'The date of the calendar event in ISO 8601 format.',
              'title': 'Date',
              'type': 'string'
          }
      },
      'required': ['name', 'date'],
      'title': 'CalendarEvent',
      'type': 'object'
    },
    modality="text"
)
```
```python Request (stream)

from uiform import UiForm

uiclient = UiForm()

doc_msg = uiclient.documents.extractions.stream(
    document = "freight/booking_confirmation.jpg", 
    model="gpt-4o-mini",
    json_schema = {
      'X-SystemPrompt': 'You are a useful assistant.',
      'properties': {
          'name': {
              'X-FieldPrompt': 'Provide a descriptive and concise name for the event.',
              'description': 'The name of the calendar event.',
              'title': 'Name',
              'type': 'string'
          },
          'date': {
              'X-FieldPrompt': 'Specify the event date in YYYY-MM-DD format.',
              'description': 'The date of the calendar event in ISO 8601 format.',
              'title': 'Date',
              'type': 'string'
          }
      },
      'required': ['name', 'date'],
      'title': 'CalendarEvent',
      'type': 'object'
    },
    modality="text"
)
```
```json Response
{
    "content": {
        "id": "chatcmpl-AoBs45TNWTB1VKGSXV7NAwCnxMaNN",
        "choices": [
            {
                "finish_reason": "stop",
                "index": 0,
                "logprobs": null,
                "message": {
                    "content": "{\"name\": \"Confirmation d'affr\\u00e9tement\", \"date\": \"2024-11-08\"}",
                    "refusal": null,
                    "role": "assistant",
                    "audio": null,
                    "function_call": null,
                    "tool_calls": [],
                    "parsed": {
                        "name": "Confirmation d'affr\u00e9tement",
                        "date": "2024-11-08"
                    }
                }
            }
        ],
        "created": 1736525396,
        "model": "gpt-4o-mini-2024-07-18",
        "object": "chat.completion",
        "service_tier": "default",
        "system_fingerprint": "fp_f2cd28694a",
        "usage": {
            "completion_tokens": 20,
            "prompt_tokens": 2760,
            "total_tokens": 2780,
            "completion_tokens_details": {
                "accepted_prediction_tokens": 0,
                "audio_tokens": 0,
                "reasoning_tokens": 0,
                "rejected_prediction_tokens": 0
            },
            "prompt_tokens_details": {
                "audio_tokens": 0,
                "cached_tokens": 0
            }
        },
        "likelihoods": {
            "name": 0.7227993785831323,
            "date": 0.7306298416895017
        },
        "regex_instruction_results": null,
        "text_operations_message": "### I tried to extract all possible text from the document, it might help you to infer values: \n/, ACME\n\n4% Corporation\u201d\n\nConfirmation d'affr\u00e9tement\nACME CORPORATION\n\nVAT Number: GB123456789\n\n11/8/2024, 11:41:43 AM\n\naA\n\nD\u00e9tails de la soci\u00e9t\u00e9 Site de: Adresse de facturation:\nContact: Jane Doe 456 Oak Avenue 123 Elm Street\nAcme Corporation Floor 3 Suite 500\nTel: +44 20 7946 0958 Manchester London\nEmail: client@acme.com M1 4WP. WC2N S5DU GB\nUnited Kingdom Tel: +44 20 7946 0958\n\nEmail: client@acme.com\nVAT Number: GB123456789\n\nR\u00e9f\u00e9rence a rappeler sur votre\nfacture\n\nN\u00b0OT : SHIP-001\n\nR\u00e9f.Client : BC-67890\n\nN\u00b0 Cde : SHIP-001\n\nTransporteur :\n\nTRANSPORT EXPRESS.\nAl'attention du Service Logistique\nZone Industrielle Est, Batiment C\n45 rue des Transporteurs\n\n75001 PARIS\n\nFRANCE\n\nT\u00e9l : 0123 45 67 89\n\nFax : 0123 45 67 90\n\nTva : FR12 345 678 901\n\nLe transporteur s'engage :\n\ne a-souscrire une assurance sp\u00e9cifique aux marchandises\nsensibles.\n\n* arespecter les clauses vol de ses polices d'assurance\nmarchandises transport\u00e9es.\n\n\u00a2 a v\u00e9rifier que les marchandises soient bien accompagn\u00e9es des\ndocuments et notamment des documents de douane\ncorrespondants.\n\n\u00a2 ad\u00e9clarer les incidents et notamment contacter imm\u00e9diatement\nnotre bureau d'affr\u00e9tement et le bureau de douanes le plus\nproche en cas de vol attest\u00e9.\n\n\u00a2 a mettre en oeuvre les moyens de pr\u00e9vention visant a la\ns\u00e9curisation de la marchandise dont le stationnement dans des\nendroits clos et gardienn\u00e9s.\n\n \n\nNature des marchandises: Prise en charge le Livraison le\nPoids: 500 T Pallets: 5 Unit\u00e9s: 10 Volume: 1.44 M3 5/2/2023 5/3/2023\nMetres de chargement: 0.4 ML De 08:00 a 12:00 De 10:00 a 16:00\nTemp\u00e9rature: 5\u00b0C - 25\u00b0C (Frais) Acme Corporation Beta Industries\nMarchandises dangereuses: UN1202 Classe 3 - Liquide 123 Elm Street 789 Pine Street\ninflammable Suite 500 Munich, Bavaria\nLondon, Greater London 80331 DE\nWC2N SDU GB +49 89 123456\n\n \n\n \n\n \n\nPrix convenu: 1500 EUR HT PRIX NEGOCIE GASOIL INCLUS R\u00e9f\u00e9rence a rappeler sur votre facture :\n\nBC-67890\n\nConditions de transport et de reglement :\n\nAfin de permettre un reglement conforme aux dispositions, il est rappel\u00e9 au transporteur affr\u00e9t\u00e9 que la facture ne sera admise pour paiement que sous\nla condition stricte de reception des documents l\u00e9gaux requis pour justifier de la r\u00e9alisation de la prestation de transport et notamment : I'original de la\nlettre de voiture accompagn\u00e9 du bon de livraison original r\u00e9gularis\u00e9 et la preuve de l'\u00e9change des palettes consign\u00e9es. II est a noter que le prix\nconvenu a fait l'objet d'une n\u00e9gociation entre les parties et qu'il integre notamment les charges de carburant sur la base de l'indice CNR du mois en\ncours a la date de r\u00e9alisation du transport. Pour les flux belges, le prix convenu comprend la taxe kilom\u00e9trique. Le transporteur affr\u00e9teur s'oblige a\nex\u00e9cuter l'ordre de transport confi\u00e9 par ses propres moyens. Il s'interdit de le sous-traiter a des tiers. Le non respect de cette clause entraine la\nr\u00e9solution imm\u00e9diate et de plein droit du contrat de transport. Il reconnait \u00e9galement que le forfait ci-dessus permet de couvrir l'ensemble des charges\nd\u00e9finies a l'article L3221-1 du Code des Transports. En cons\u00e9quence, il d\u00e9clare \u00e9tre a jour de son obligation de d\u00e9claration, du paiement des charges\nsociales (URSSAF) et du respect de la lutte contre le travail ill\u00e9gal. Il s'engage a respecter les obligations sur le d\u00e9tachement transnational de salari\u00e9s,\naussi il doit \u00e9tre a jour de |'\u00e9tablissement de I'attestation de d\u00e9tachement des salari\u00e9s ainsi que de la nomination d'un repr\u00e9sentant en France. Nous\nvous rappelons la l\u00e9gislation frangaise concernant le cabotage routier de marchandises qui fait l'objet des articles L.3421-3 et suivants du Code des\nTransports modifi\u00e9s par le d\u00e9cret n\u00b0 2016-418 du 7 avril 2016, tout transport doit donc \u00e9tre effectu\u00e9 dans le respect de la loi. Nous vous remercions de\nnous tenir imm\u00e9diatement inform\u00e9s de tout incident rencontr\u00e9 dans |'ex\u00e9cution de ce transport.\n\n \n\nSile transport de marchandises s'effectue sur Retour imp\u00e9ratif par fax avec la mention Bon\ndes palettes Europe, celles-ci doivent \u00e9tre pour accord, votre cachet commercial, vos\n\u00e9chang\u00e9es au chargement ou restitu\u00e9es sous noms et signature. A d\u00e9faut de retour, le\n\n8 jours. Dans le cas contraire, elles vous seront contrat de transport sera r\u00e9put\u00e9 ex\u00e9cut\u00e9 selon\nfactur\u00e9es au prix de 28 \u20ac ht/Palette (14 \u20achtde \u2014_les modalit\u00e9s pr\u00e9cit\u00e9es.Tous les bons de\n\nfrais de dossier non remboursable en cas livraisons devront \u00e9tre retourn\u00e9s sous 8 jours.\nd'avoir).\n\n \n\n \n\n \n\f"
    },
    "error": null
}
```
</CodeGroup>



## Templates
### templates.documentai

The Document AI templates allow you to extract structured data from documents using predefined templates inspired by Google Document AI. These templates are designed to handle common document types like invoices, receipts, IDs and more.

**templates.documentai.parse**

<ParamField path="templates.documentai.parse" type="function">
  Extract structured data from a document using a predefined template inspired by Google Document AI
  <Expandable title="parameters">
    <ParamField path="template" type="DocumentAITemplate" required>
      The template to use for extraction. Must be one of:
      - "bank_statement" - Extract data from bank statements
      - "contract" - Extract data from contracts
      - "driver_license" - Extract data from driver licenses
      - "expense" - Extract data from expense reports
      - "identity_proofing" - Extract data for identity verification
      - "invoice" - Extract data from invoices
      - "passport" - Extract data from passports
      - "pay_slip" - Extract data from pay slips
      - "w2" - Extract data from W-2 forms
    </ParamField>
    
    <ParamField path="document" type="Path | str | IO[bytes] | MIMEData" required>
      The document to extract from. Can be a file path, string, bytes IO object, or MIMEData.
    </ParamField>

    <ParamField path="text_operations" type="TextOperations">
      Optional text operations to perform on the document:
      <Expandable title="properties">
        <ParamField path="regex_instructions" type="array[RegexInstruction]">
          List of regex patterns to identify data in the text
          <Expandable title="RegexInstruction properties">
            <ParamField path="name" type="string">Key/label for data (e.g., "VATNumber")</ParamField>
            <ParamField path="pattern" type="string">Regex pattern to match</ParamField>
            <ParamField path="description" type="string">Description of what to extract</ParamField>
          </Expandable>
        </ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="image_operations" type="ImageOperations">
      Optional image preprocessing operations:
      <Expandable title="properties">
        <ParamField path="correct_image_orientation" type="boolean">Whether to correct the image orientation</ParamField>
        <ParamField path="dpi" type="integer">The DPI of the image</ParamField>
        <ParamField path="image_to_text" type="'ocr' | 'llm_description'">Whether to convert the image to text</ParamField>
        <ParamField path="browser_canvas" type="'A3' | 'A4' | 'A5'">The canvas of the browser (default = A4)</ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="model" type="string" default="gpt-4o-2024-08-06">
      The model to use for extraction.
    </ParamField>

    <ParamField path="temperature" type="float" default="0">
      The sampling temperature to use.
    </ParamField>

    <ParamField path="messages" type="array[ChatCompletionUiformMessage]" default="[]">
      Optional list of previous messages to include. Each message must have:
      <Expandable title="properties">
        <ParamField path="role" type="string">
          The role of the message sender. Must be one of:
          - "user"
          - "system" 
          - "assistant"
        </ParamField>
        <ParamField path="content" type="string | array[ChatCompletionContentPartParam]">
          The content of the message. Can be a string or array of content parts:
          <Expandable title="ChatCompletionContentPartParam">
            <ParamField path="text" type="object">
              A text content part
              <Expandable title="properties">
                <ParamField path="text" type="string">
                  The text content
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "text"
                </ParamField>
              </Expandable>
            </ParamField>

            <ParamField path="image_url" type="object">
              An image content part
              <Expandable title="properties">
                <ParamField path="image_url" type="object">
                  <Expandable title="properties">
                    <ParamField path="url" type="string">
                      URL or base64 encoded image data
                    </ParamField>
                    <ParamField path="detail" type="string">
                      Detail level: "auto", "low", or "high"
                    </ParamField>
                  </Expandable>
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "image_url"
                </ParamField>
              </Expandable>
            </ParamField>

            <ParamField path="input_audio" type="object">
              An audio content part
              <Expandable title="properties">
                <ParamField path="input_audio" type="object">
                  <Expandable title="properties">
                    <ParamField path="data" type="string">
                      Base64 encoded audio data
                    </ParamField>
                    <ParamField path="format" type="string">
                      Must be "wav" or "mp3"
                    </ParamField>
                  </Expandable>
                </ParamField>
                <ParamField path="type" type="string">
                  Must be "input_audio"
                </ParamField>
              </Expandable>
            </ParamField>
          </Expandable>
        </ParamField>
      </Expandable>
    </ParamField>

    <ParamField path="modality" type="string" default="native">
      The modality to use for processing the document. Can be:
      - "native" (default) - Uses the document's native modality based on file type
      - "image+text" - Uses both the document's native modality and processes as text
      - "text" - Process as text
      - "image" - Process as image 
      - "audio" - Process as audio
      - "video" - Process as video
    </ParamField>

    <ParamField path="store" type="boolean" default="false">
      Whether to store the document and extraction results.
    </ParamField>

  </Expandable>
</ParamField>

<ResponseField name="Response" type="DocumentExtractResponse">
The extraction response containing the structured data.
</ResponseField>



<CodeGroup>
```python Request (parse)

from uiform import UiForm

uiclient = UiForm()

doc_msg = uiclient.documents.templates.documentai.parse(
    document = "freight/booking_confirmation.jpg", 
    model="gpt-4o-mini",
    template="invoice",
    modality="text"
)
```
```python Request (stream)

from uiform import UiForm

uiclient = UiForm()

doc_msg = uiclient.documents.templates.documentai.stream(
    document = "freight/booking_confirmation.jpg", 
    model="gpt-4o-mini",
    template="invoice",
    modality="text"
)
```
```json Response
{
    "content": {
        "id": "chatcmpl-AoBs45TNWTB1VKGSXV7NAwCnxMaNN",
        "choices": [
            {
                "finish_reason": "stop",
                "index": 0,
                "logprobs": null,
                "message": {
                    "content": "{\"name\": \"Confirmation d'affr\\u00e9tement\", \"date\": \"2024-11-08\"}",
                    "refusal": null,
                    "role": "assistant",
                    "audio": null,
                    "function_call": null,
                    "tool_calls": [],
                    "parsed": {
                        "name": "Confirmation d'affr\u00e9tement",
                        "date": "2024-11-08"
                    }
                }
            }
        ],
        "created": 1736525396,
        "model": "gpt-4o-mini-2024-07-18",
        "object": "chat.completion",
        "service_tier": "default",
        "system_fingerprint": "fp_f2cd28694a",
        "usage": {
            "completion_tokens": 20,
            "prompt_tokens": 2760,
            "total_tokens": 2780,
            "completion_tokens_details": {
                "accepted_prediction_tokens": 0,
                "audio_tokens": 0,
                "reasoning_tokens": 0,
                "rejected_prediction_tokens": 0
            },
            "prompt_tokens_details": {
                "audio_tokens": 0,
                "cached_tokens": 0
            }
        },
        "likelihoods": {
            "name": 0.7227993785831323,
            "date": 0.7306298416895017
        },
        "regex_instruction_results": null,
        "text_operations_message": "### I tried to extract all possible text from the document, it might help you to infer values: \n/, ACME\n\n4% Corporation\u201d\n\nConfirmation d'affr\u00e9tement\nACME CORPORATION\n\nVAT Number: GB123456789\n\n11/8/2024, 11:41:43 AM\n\naA\n\nD\u00e9tails de la soci\u00e9t\u00e9 Site de: Adresse de facturation:\nContact: Jane Doe 456 Oak Avenue 123 Elm Street\nAcme Corporation Floor 3 Suite 500\nTel: +44 20 7946 0958 Manchester London\nEmail: client@acme.com M1 4WP. WC2N S5DU GB\nUnited Kingdom Tel: +44 20 7946 0958\n\nEmail: client@acme.com\nVAT Number: GB123456789\n\nR\u00e9f\u00e9rence a rappeler sur votre\nfacture\n\nN\u00b0OT : SHIP-001\n\nR\u00e9f.Client : BC-67890\n\nN\u00b0 Cde : SHIP-001\n\nTransporteur :\n\nTRANSPORT EXPRESS.\nAl'attention du Service Logistique\nZone Industrielle Est, Batiment C\n45 rue des Transporteurs\n\n75001 PARIS\n\nFRANCE\n\nT\u00e9l : 0123 45 67 89\n\nFax : 0123 45 67 90\n\nTva : FR12 345 678 901\n\nLe transporteur s'engage :\n\ne a-souscrire une assurance sp\u00e9cifique aux marchandises\nsensibles.\n\n* arespecter les clauses vol de ses polices d'assurance\nmarchandises transport\u00e9es.\n\n\u00a2 a v\u00e9rifier que les marchandises soient bien accompagn\u00e9es des\ndocuments et notamment des documents de douane\ncorrespondants.\n\n\u00a2 ad\u00e9clarer les incidents et notamment contacter imm\u00e9diatement\nnotre bureau d'affr\u00e9tement et le bureau de douanes le plus\nproche en cas de vol attest\u00e9.\n\n\u00a2 a mettre en oeuvre les moyens de pr\u00e9vention visant a la\ns\u00e9curisation de la marchandise dont le stationnement dans des\nendroits clos et gardienn\u00e9s.\n\n \n\nNature des marchandises: Prise en charge le Livraison le\nPoids: 500 T Pallets: 5 Unit\u00e9s: 10 Volume: 1.44 M3 5/2/2023 5/3/2023\nMetres de chargement: 0.4 ML De 08:00 a 12:00 De 10:00 a 16:00\nTemp\u00e9rature: 5\u00b0C - 25\u00b0C (Frais) Acme Corporation Beta Industries\nMarchandises dangereuses: UN1202 Classe 3 - Liquide 123 Elm Street 789 Pine Street\ninflammable Suite 500 Munich, Bavaria\nLondon, Greater London 80331 DE\nWC2N SDU GB +49 89 123456\n\n \n\n \n\n \n\nPrix convenu: 1500 EUR HT PRIX NEGOCIE GASOIL INCLUS R\u00e9f\u00e9rence a rappeler sur votre facture :\n\nBC-67890\n\nConditions de transport et de reglement :\n\nAfin de permettre un reglement conforme aux dispositions, il est rappel\u00e9 au transporteur affr\u00e9t\u00e9 que la facture ne sera admise pour paiement que sous\nla condition stricte de reception des documents l\u00e9gaux requis pour justifier de la r\u00e9alisation de la prestation de transport et notamment : I'original de la\nlettre de voiture accompagn\u00e9 du bon de livraison original r\u00e9gularis\u00e9 et la preuve de l'\u00e9change des palettes consign\u00e9es. II est a noter que le prix\nconvenu a fait l'objet d'une n\u00e9gociation entre les parties et qu'il integre notamment les charges de carburant sur la base de l'indice CNR du mois en\ncours a la date de r\u00e9alisation du transport. Pour les flux belges, le prix convenu comprend la taxe kilom\u00e9trique. Le transporteur affr\u00e9teur s'oblige a\nex\u00e9cuter l'ordre de transport confi\u00e9 par ses propres moyens. Il s'interdit de le sous-traiter a des tiers. Le non respect de cette clause entraine la\nr\u00e9solution imm\u00e9diate et de plein droit du contrat de transport. Il reconnait \u00e9galement que le forfait ci-dessus permet de couvrir l'ensemble des charges\nd\u00e9finies a l'article L3221-1 du Code des Transports. En cons\u00e9quence, il d\u00e9clare \u00e9tre a jour de son obligation de d\u00e9claration, du paiement des charges\nsociales (URSSAF) et du respect de la lutte contre le travail ill\u00e9gal. Il s'engage a respecter les obligations sur le d\u00e9tachement transnational de salari\u00e9s,\naussi il doit \u00e9tre a jour de |'\u00e9tablissement de I'attestation de d\u00e9tachement des salari\u00e9s ainsi que de la nomination d'un repr\u00e9sentant en France. Nous\nvous rappelons la l\u00e9gislation frangaise concernant le cabotage routier de marchandises qui fait l'objet des articles L.3421-3 et suivants du Code des\nTransports modifi\u00e9s par le d\u00e9cret n\u00b0 2016-418 du 7 avril 2016, tout transport doit donc \u00e9tre effectu\u00e9 dans le respect de la loi. Nous vous remercions de\nnous tenir imm\u00e9diatement inform\u00e9s de tout incident rencontr\u00e9 dans |'ex\u00e9cution de ce transport.\n\n \n\nSile transport de marchandises s'effectue sur Retour imp\u00e9ratif par fax avec la mention Bon\ndes palettes Europe, celles-ci doivent \u00e9tre pour accord, votre cachet commercial, vos\n\u00e9chang\u00e9es au chargement ou restitu\u00e9es sous noms et signature. A d\u00e9faut de retour, le\n\n8 jours. Dans le cas contraire, elles vous seront contrat de transport sera r\u00e9put\u00e9 ex\u00e9cut\u00e9 selon\nfactur\u00e9es au prix de 28 \u20ac ht/Palette (14 \u20achtde \u2014_les modalit\u00e9s pr\u00e9cit\u00e9es.Tous les bons de\n\nfrais de dossier non remboursable en cas livraisons devront \u00e9tre retourn\u00e9s sous 8 jours.\nd'avoir).\n\n \n\n \n\n \n\f"
    },
    "error": null
}
```
</CodeGroup>
