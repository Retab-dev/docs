## Sync & Async Client


UiForm offers both **synchronous** and **asynchronous** client interfaces, making it versatile for different application needs. The asynchronous client (`AsyncUiForm`) is ideal for high-performance, non-blocking applications where multiple tasks run concurrently. For simpler or blocking operations, the synchronous client (`UiForm`) provides a straightforward approach.

Hereâ€™s how you can use both:

```python
# Async client
from uiform import AsyncUiForm

async def fetch_models():
    uiclient = AsyncUiForm()
    models = await uiclient.models.list()
    print(models)

# Sync client
from uiform import UiForm

client = UiForm()
models = client.models.list()
print(models)
```

Both clients provide the same core functionality, enabling you to list models, create messages, extract data from documents, and more, with the flexibility to match your application's concurrency model.


## Rate Limits

UiForm implements rate limiting to ensure stable service for all users. The API uses a rolling window rate limit with the following configuration:

- **300 requests** per **60-second** window
- Applies across the following API endpoints:
  - `POST /api/v1/documents/extractions`
  - `POST /api/v1/documents/create_messages`

When you exceed the rate limit, the API will return a `429 Too Many Requests` response. The response headers will include:

```bash
Status 429 - {'detail': 'Rate limit exceeded. Please try again later.'}
```

For high-volume applications, we can provide a dedicated plan. [Contact us](mailto:contact@uiform.com) for more information.


## Modality

LLM works with text and image data. UiForm converts documents into different modalities, based on the document type.

#### Native modalities

Here are the list of native modalities supported by UiForm:

<CodeGroup>

```python text
TEXT_TYPES = Literal[".txt", ".csv", ".tsv", ".md", ".log", ".html", ".htm", ".xml", ".json", ".yaml", ".yml", ".rtf", ".ini", ".conf", ".cfg", ".nfo", ".srt", ".sql", ".sh", ".bat", ".ps1", ".js", ".jsx", ".ts", ".tsx", ".py", ".java", ".c", ".cpp", ".cs", ".rb", ".php", ".swift", ".kt", ".go", ".rs", ".pl", ".r", ".m", ".scala"]
```


```python image
IMAGE_TYPES = Literal[".jpg", ".jpeg", ".png", ".gif", ".bmp", ".tiff"]
EXCEL_TYPES = Literal[".xls", ".xlsx", ".ods"]
WORD_TYPES = Literal[".doc", ".docx", ".odt"]
PPT_TYPES = Literal[".ppt", ".pptx", ".odp"]
PDF_TYPES = Literal[".pdf"]
```

```python audio
# Coming soon
```

```python email
# Emails are mime files which contains other mime files (their attachments). 
# Each mime file is converted into its native modality.
EMAIL_TYPES = Literal[".eml", ".msg"]
```

</CodeGroup>


You can also use the `modality` parameter to specify the modality of the document and override the default modality.

```Python {14-15}
import json
from uiform.client import UiForm

with open("booking_confirmation_json_schema.json", "r") as f:
    json_schema = json.load(f)

client = UiForm()

response = client.documents.extract(
    json_schema = json_schema,
    document="booking_confirmation.jpg",
    model="gpt-4o-mini-2024-07-18",
    temperature=0,
    modality='text' # The image will be converted to text (with an OCR model) before being sent to the LLM
)
```

## Idempotency

Idempotency in UIForm ensures that repeated API requests with the same idempotency key are handled consistently without duplicating processing or generating unintended side effects. When a request is made, UIForm checks if a record with the same idempotency key exists in its database. If a match is found:  

1. **If the request content matches the original request:** The previously computed response is returned.  
2. **If the request content differs:** An error is returned, indicating a conflict.  
3. **If the original request is still being processed:** The API prevents concurrent execution by blocking duplicate processing.  

By leveraging idempotency, UIForm ensures each document or operation is processed only once, returning consistent results and avoiding unnecessary computation.  

## Text Operations

When processing documents, you may want to provide additional context to help the AI better understand the document. This could be previous communications, related documents, or any other relevant information.

### Regex Instructions

Define custom patterns to extract specific data types:
- **Document Numbers**: Extract invoice numbers, PO numbers, etc.
- **Custom Formats**: Identify company-specific identifiers
- **Validation**: Ensure extracted data matches expected patterns

<CodeGroup>
```json RegexInstructions
{
  "regex_instructions": [
    {
      "name": "InvoiceNumber",
      "pattern": "INV-\\d{6}",
      "description": "Matches invoice numbers in format INV-XXXXXX"
    },
    {
      "name": "EUVatNumber",
      "pattern": "^[A-Z]{2}\\d{8,12}$",
      "description": "Matches EU VAT numbers"
    }
  ]
}
```
```Python main.py {9-16,23}
import json
from uiform.client import UiForm

with open("booking_confirmation_json_schema.json", "r") as f:
    json_schema = json.load(f)

client = UiForm()

text_operations = {'regex_instructions' : [
        {
            "name": "vat_number",
            "pattern": r"[Ff][Rr]\s*(\d\s*){11}",
            "description": "VAT number in the format XX999999999"
        }
    ]
}

response = client.documents.extract(
    json_schema = json_schema,
    document = "booking_confirmation.jpg",
    model="gpt-4o-mini-2024-07-18",
    temperature=0,
    text_operations=text_operations
)
```
</CodeGroup>




**Best Practices**
- Use consistent formatting in regex patterns
- Only use regex patterns to extract data that is not easily extracted by the LLM


### API Reference

<ResponseField name="text_operations" type="TextOperations Object">
  Mathematical operations performed on the text to help the AI better extract the data.
  <Expandable title="properties">
    <ResponseField name="regex_instructions" type="array[RegexInstruction]">
      List of regex-based instructions to identify potential data candidates in the text
      <Expandable title="RegexInstruction properties">
        <ResponseField name="name" type="string">
          A key or label for the data being extracted (e.g., "VATNumber")
        </ResponseField>
        <ResponseField name="pattern" type="string">
          The regex pattern to search for
        </ResponseField>
        <ResponseField name="description" type="string">
          A human-readable explanation of what is being extracted
        </ResponseField>
      </Expandable>
    </ResponseField>
  </Expandable>
</ResponseField>

## Image Operations (Coming Soon)

When processing images, several factors can affect the LLM's ability to accurately interpret and extract information. The image_operations parameter allows you to preprocess images to improve extraction quality.

#### API Reference

<ResponseField name="image_operations" type="ImageOperations Object">
  Image preprocessing operations to optimize document analysis.
  <Expandable title="properties">
    <ResponseField name="orientation_correction" type="boolean">
      Automatically detect and correct image orientation
    </ResponseField>
    <ResponseField name="resolution" type="object">
      <Expandable title="properties">
        <ResponseField name="min_dpi" type="integer">
          Minimum dots per inch (DPI) required for processing
        </ResponseField>
        <ResponseField name="upscale" type="boolean">
          Whether to upscale images below min_dpi
        </ResponseField>
      </Expandable>
    </ResponseField>
    <ResponseField name="noise_reduction" type="object">
      <Expandable title="properties">
        <ResponseField name="denoise" type="boolean">
          Apply noise reduction algorithms
        </ResponseField>
        <ResponseField name="remove_artifacts" type="boolean">
          Remove compression and scanning artifacts
        </ResponseField>
      </Expandable>
    </ResponseField>
    <ResponseField name="enhancement" type="object">
      <Expandable title="properties">
        <ResponseField name="contrast" type="boolean">
          Enhance contrast between text and background
        </ResponseField>
        <ResponseField name="sharpness" type="boolean">
          Improve image sharpness and clarity
        </ResponseField>
        <ResponseField name="lighting" type="boolean">
          Correct uneven lighting and exposure
        </ResponseField>
      </Expandable>
    </ResponseField>
    <ResponseField name="ocr_optimization" type="object">
      <Expandable title="properties">
        <ResponseField name="deskew" type="boolean">
          Correct text skew and warping
        </ResponseField>
        <ResponseField name="remove_background" type="boolean">
          Isolate text from complex backgrounds
        </ResponseField>
      </Expandable>
    </ResponseField>
  </Expandable>
</ResponseField>

